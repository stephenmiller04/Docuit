<!DOCTYPE html>
<html>
<head>
<title>Docuit - Editor [ALPHA VERSION]</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="css/style.css">
<link rel="stylesheet" href="css/highlighter.style.css">
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
<script type="text/javascript" src="js/jquery.highlight.js"></script>
<script type="text/javascript" src="js/markdown-to-html.js"></script>
<script type="text/javascript">

</script>
</head>
<body>
<div id="toolbar">
  <img id="toolbar_new" class="tbicon tbnew" onclick="newfile()" src="img/file.svg">
  <img id="toolbar_load" class="tbicon" onclick="loadbutton()" src="img/folder.svg">
  <img id="toolbar_save" class="tbicon" onclick="hallo()" src="img/save.svg">
  <div id="version">v0.7.3</div>
</div>
<div id="editor">
<textarea id="htmleditor" placeholder="" oninput="realtimeedit()">
# BIG TITLE
## Little title
Some normal text.

Name           | City          | Age           |
:------------- | ------------- | ------------- |
John Doe       | New York      | 41            |
Stephen Miller | Budapest      | 20            |

And some code highlighting.

```
public class Main {
    public static void main(String[] args) {
        System.out.println("Hello, World!");
    }
}
```

Inline `code highlight`.

Also, you can drag'n'drop a text file here.
</textarea>
</div>

<div id="resize">
	<img class="resizecenter" src="img/dots.png">
</div>

<div id="htmlpreview">
	<div id="content">

  </div>
</div>

</textarea>

<script>
function realtimeedit() {
  var editorcontent = document.getElementById('htmleditor').value;
  var editorcontentfix = editorcontent.replace(/\$/g,"&#x24;");
  markdownToHtml(editorcontentfix, document.getElementById('content'));
  $(document).ready(function(){
    $('pre.code').highlight({source:1, zebra:1, indent:'space', list:'ol'});
  });
};

realtimeedit();

function handleFileSelect(evt) {
  evt.stopPropagation();
  evt.preventDefault();

  var files = evt.dataTransfer.files;
  var reader = new FileReader();
  reader.onload = function(event) {
       document.getElementById('htmleditor').value = event.target.result;
       realtimeedit();
  }
  reader.readAsText(files[0],"UTF-8");
}

function handleDragOver(evt) {
  evt.stopPropagation();
  evt.preventDefault();
  evt.dataTransfer.dropEffect = 'copy';
}

var dropZone = document.getElementById('htmleditor');
dropZone.addEventListener('dragover', handleDragOver, false);
dropZone.addEventListener('drop', handleFileSelect, false);

const {ipcRenderer} = require('electron')

function loadbutton() {
  ipcRenderer.send('openFile', () => {
    console.log("Event sent.");
  })
}

ipcRenderer.on('fileData', (event, data) => {
  document.getElementById('htmleditor').value = data;
  realtimeedit();
})
function newfile(){
  dialog.showMessageBox({
      type: 'info',
      buttons: ['Yes', 'No'],
      message: 'Make a new document?\nMake sure you already saved your work!',
  }, resp => {
      if (resp === 0) {
          document.getElementById('htmleditor').value = "";
          realtimeedit();
      }
  });
}


var app = require('electron').remote;
var dialog = app.dialog;
var fs = require('fs');

document.getElementById('toolbar_save').onclick = () => {
  dialog.showSaveDialog((fileName) => {
    if(fileName === undefined){
      alert("You didn't save the file");
      return;
    }

    var content = document.getElementById('htmleditor').value;

    fs.writeFile(fileName, content, (err) => {
      if (err) console.log(err);
      alert("Document saved successfully!");
    })
  });
};
</script>
</body>
</html>
